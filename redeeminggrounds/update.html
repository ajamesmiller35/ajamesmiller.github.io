<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="bootstrap-rg.css">
    <link rel="stylesheet" href="rgstyles.css">
    <link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Permanent+Marker" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Syncopate:400,700" rel="stylesheet">
    <link rel="icon" href="images/rg-icon-green.png">
    <title>Redeeming Grounds Coffee</title>
  </head>
  <body>
    <div class="push">

    <div class="logout-box">
      <div class="button-box">
        <button id="update" class="btn btn-danger update-btn">Update</button>
        <button id="sign-out" class="btn btn-danger update-btn">Sign Out</button>
      </div>
    </div>
  </div>

    <img id="rg-banner" src="images/rg-logo.png">
    
    <div class="chalkboard" id="chalkboard-main">
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="burger-box">
            <button class="navbar-toggler" id="toggle-button" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              </div>  
            <div class="nav-chalkboard text-center" id="fixed-nav">
              <div class="collapse navbar-collapse" id="navbarsExampleDefault">
                <ul class="navbar-nav mr-auto">
                  <li class="nav-item">
                    <a class="nav-link scrollTo" href="#specials">Specials</a>
                  </li>
                  <li class="nav-divider">/</li>
                  <li class="nav-item">
                    <a class="nav-link scrollTo" href="#refills">Menu</a>
                  </li>
                  <li class="nav-divider">/</li>
                  <li class="nav-item">
                    <a class="nav-link scrollTo" href="#about">Our Coffee</a>
                  </li>
                  <li class="nav-divider">/</li>
                  <li class="nav-item">
                    <a class="nav-link scrollTo" href="#about">Events</a>
                  </li>
                </ul>
              </div>
            </div>
            </nav>
            <div class="division"></div>
        <p class="rg-info text-white h1" contenteditable="true" id="nav-message">Tribune's top spot for the best quality coffee at reasonable prices!</p>
    </div><!--chalkboard-->
    <div class="chalkboard">
      <div class="containter">
          <p class="rg-info text-white h1">Latest Tip Jar Poll:</p>
          <div class="division"></div>
          <div class="row">
              <div class="col-lg-3">
              <p class="rg-info text-white h1" contenteditable="true" id="poll1">Ford</p>
              </div>
              <div class="col-lg-1"><div class="vertical-division"></div></div>
              <div class="col-lg-8">
              <p class="rg-info text-white h1" contenteditable="true" id="poll-tips1">Enter tips collected</p>
              </div>
            </div>
          <div class="row">
              <div class="col-lg-3">
              <p class="rg-info text-white h1" contenteditable="true" id="poll2">Chevy</p>
              </div>
              <div class="col-lg-1"><div class="vertical-division"></div></div>
              <div class="col-lg-8">
              <p class="rg-info text-white h1" contenteditable="true" id="poll-tips2">Enter tips collected</p>
              </div>
            </div>
      </div><!--container-->
    </div><!--chalkboard-->
    <div class="text-center">
        <h1 class="rg-title">Current Specials:</h1>
    </div>
    <div class="chalkboard">
      <div class="container">
        <p class="rg-info text-white h1">Current Specials Here</p>
        <div class="row">
          <div class="col-lg-6"><img class="cup" src="images/coffee-cup-white.png"/></div>
          <div class="col-lg-6">
              <table style="height: 100%">
                  <tbody>
                    <tr>
                      <td class="align-middle"><p id="special1" class="rg-info text-white h1" contenteditable="true">Pumpkin Spice Latte</p></td>
                    </tr>
                    <tr>
                        <td class="align-middle"><p id="special2" class="rg-info text-white h1" contenteditable="true">Pumpkin Spice Latte</p></td>
                      </tr>
                      <tr>
                          <td class="align-middle"><p id="special3" class="rg-info text-white h1" contenteditable="true">Pumpkin Spice Latte</p></td>
                        </tr>
                        <tr>
                            <td class="align-middle"><p id="special4" class="rg-info text-white h1" contenteditable="true">Pumpkin Spice Latte</p></td>
                          </tr>
                  </tbody>
                </table>
          </div>
        </div><!--row-->
      </div><!--container-->
      </div><!--chalkboard-->
    <div class="text-center">
        <h1 class="rg-title">Events:</h1>
    </div>
    <div class="chalkboard">
      <div class="container">
        <div class="row">
          <div class="col-lg-6">
      <a id="upload" href="javascript:void(0);"><img src="images/add-photo.png" id="add-photo"></a>
      <input id="file-input" accept=".jpg" type="file" name="name" style="display: none;" />
    </div><!--col-->
    <div class="col-lg-6">
      <div class="event-info">
        <p class="rg-info text-white h1" id="event-title" contenteditable="true">Sample Event!</p>
        <p class="text-white" id="event-description" contenteditable="true">Enter event information here...</p>
      </div><!--event-info-->
    </div><!--col-->
    </div><!--row-->  
    </div><!--container-->
    </div><!--chalkboard-->
    <div class="chalkboard">
        <div class="container">
            <p class="rg-info text-white h1">Administrator Contact:</p>
            <div class="divider"></div>
              <div class="footer-info-box row">           
                  <a id="admin-mail" href="mailto:admin@dixondrug.com"><img class="social-icon" src="images/email-icon.png"/></a>
            </div><!--footer-info-box-->
              <div class="divider"></div>
          </div><!--row-->
        </div><!--container-->
    </div><!--chalkboard-->
      
    
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script>

        $('#upload').on('click', function() {
        $('#file-input').trigger('click');
        console.log('click');
      });
    </script> 
    <script>
      var input = document.querySelector('input');
    </script> 
    <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-app.js"></script>
  
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-database.js"></script>





    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
        apiKey: "AIzaSyBFpRUDRWdeGNtfWg7CcM_m-1Y-sVmcTPg",
        authDomain: "redeeming-grounds.firebaseapp.com",
        databaseURL: "https://redeeming-grounds.firebaseio.com",
        projectId: "redeeming-grounds",
        storageBucket: "redeeming-grounds.appspot.com",
        messagingSenderId: "623286935158",
        appId: "1:623286935158:web:c5301b5e11b696f2"
        };
       // Initialize Firebase
       firebase.initializeApp(firebaseConfig);
   
       firebase.auth().onAuthStateChanged(function(user) {
           console.log(user);
           $('#welcome').append(user.email);
           $('#welcome').append('!');
       });
   
       $(document).on('click', '#sign-out', function(event){
       firebase.auth().signOut().then(function() {
           // Sign-out successful.
           window.location.href="index.html";
       }).catch(function(error) {
           // An error happened.
           console.log(error);
       });
       });

       var pageData;

   firebase.database().ref('/rg-data/').once('value').then(function(snapshot) {
    pageData = snapshot.val();

    var total = Number(pageData.pollTips1) + Number(pageData.pollTips2);
    var graph1 = Math.trunc(Number(pageData.pollTips1)/total * 1000)/10;
    var graph2 = Math.trunc(Number(pageData.pollTips2)/total * 1000)/10;
    console.log('total = ' + total);
    console.log("graph1 = " + graph1);
    console.log("graph2 = " + graph2);

    console.log(pageData);
    $('#nav-message').text(pageData.navMessage);
    $('#poll1').text(pageData.pollOption1);
    $('#poll2').text(pageData.pollOption2);
    $('#graph1').css('width', graph1 + '%');
    $('#graph-text1').text(graph1 + '%');
    $('#graph2').css('width', graph2 + '%');
    $('#graph-text2').text(graph2 + '%');
    $('#special1').text(pageData.special1);
    $('#special2').text(pageData.special2);
    $('#special3').text(pageData.special3);
    $('#special4').text(pageData.special4);
    $('#special4').text(pageData.special4);
    $('#event-title').text(pageData.eventTitle);
    $('#event-description').text(pageData.eventDescription);

    // Create a reference to the file we want to download
    var gsReference = storage.refFromURL('gs://redeeming-grounds.appspot.com/event-photo.jpg')

    // Get the download URL
    gsReference.getDownloadURL().then(function(url) {
    console.log(url);
    $('#event-photo').attr('src', url);
    }).catch(function(error) {
        // A full list of error codes is available at
  // https://firebase.google.com/docs/storage/web/handle-errors
  switch (error.code) {
    case 'storage/object-not-found':
      // File doesn't exist
      break;

    case 'storage/unauthorized':
      // User doesn't have permission to access the object
      break;

    case 'storage/canceled':
      // User canceled the upload
      break;

  }
});

    });


       $(document).on('click', '#update', function(event){
        var database = firebase.database();
        var storageRef = firebase.storage().ref();

         var filename = input.files[0].name;
         var mountainsRef = storageRef.child(filename);
         var uploadTask = storageRef.child('event-photo.jpg').put(input.files[0]);
         var navMessage = $('#nav-message').html();
         var poll1 = $('#poll1').html();
         var pollTips1 = $('#poll-tips1').html();
         var poll2 = $('#poll2').html();
         var pollTips2 = $('#poll-tips2').html();
         var special1 = $('#special1').html();
         var special2 = $('#special2').html();
         var special3 = $('#special3').html();
         var special4 = $('#special4').html();
         var eventTitle = $('#event-title').html();
         var eventDescription = $('#event-description').html();
         function writeUserData(navMessage, poll1, pollTips1, poll2, pollTips2, special1, special2, special3, special4, eventTitle, eventDescription ) {
          firebase.database().ref('/rg-data/').set({
            navMessage: navMessage,
            pollOption1: poll1,
            pollTips1 : pollTips1,
            pollOption2: poll2,
            pollTips2 : pollTips2,
            special1: special1,
            special2: special2,
            special3: special3,
            special4: special4,
            eventTitle: eventTitle,
            eventDescription: eventDescription
          }, function(error) {
          if (error) {
            // The write failed...
            console.log(error);
          } else {
            // Data saved successfully!
          }
        });
      }
        writeUserData(navMessage, poll1, pollTips1, poll2, pollTips2, special1, special2, special3, special4, eventTitle, eventDescription );
        console.log(navMessage, poll1, pollTips1, poll2, pollTips2, special1, special2, special3, special4, eventTitle, eventDescription );
       });   
       
       </script>

  </body>
</html>